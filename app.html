<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RankEval • SteamID & Team Viewer</title>
  <style>
    :root{
      --bg:#0f1222;--card:#151935;--muted:#8b93bd;--text:#e8ecff;--accent:#6ea8fe;--ok:#3ddc97;--err:#ff6b6b;--radius:14px;--chip:rgba(255,255,255,0.08);--stripe:rgba(255,255,255,0.04)
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--text);background:radial-gradient(1200px 800px at 10% 0%,#1a1f47 0%,var(--bg) 60%),var(--bg);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    .container{max-width:1060px;margin:40px auto;padding:0 16px 64px}
    header{margin-bottom:16px}
    h1{margin:0;font-weight:800;font-size:24px}
    .subtitle{color:var(--muted);font-size:13px;margin-top:6px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.04),rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.08);border-radius:var(--radius);box-shadow:0 10px 30px rgba(0,0,0,.35),inset 0 1px 0 rgba(255,255,255,.05)}
    .controls{padding:14px;display:grid;grid-template-columns:1fr auto auto;gap:10px;align-items:end}
    label{font-size:12px;color:var(--muted)}
    .input{display:grid;gap:6px}
    input[type=text]{width:100%;background:#0e1330;color:var(--text);border:1px solid rgba(255,255,255,.1);padding:12px;border-radius:10px;font-size:14px;outline:none}
    input[type=text]:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(110,168,254,.25)}
    button{appearance:none;border:0;cursor:pointer;padding:12px 14px;border-radius:10px;font-weight:700}
    .btn-primary{background:var(--accent);color:#0a0f2b}
    .btn-ghost{background:rgba(255,255,255,.08);color:var(--text)}
    .row{display:flex;gap:10px;align-items:center}

    /* SteamID Block */
    .result{margin-top:16px;padding:16px;display:flex;justify-content:space-between;align-items:center;gap:12px}
    .muted{color:var(--muted);font-size:13px}
    .big{font-size:18px;font-weight:800}
    .err{color:var(--err)}
    code{background:#0b0f24;border:1px solid rgba(255,255,255,.08);padding:8px 10px;border-radius:8px}

    /* Team section */
    .section{margin-top:18px}
    .section h3{margin:0 0 10px;font-size:16px}
    .kpis{display:grid;grid-template-columns:repeat(6, minmax(0,1fr));gap:8px}
    .kpi{background:var(--chip);padding:10px;border-radius:10px;text-align:center}
    .kpi .label{font-size:11px;color:var(--muted)}
    .kpi .value{font-weight:800;font-size:16px}
    .team-head{padding:14px;display:flex;justify-content:space-between;align-items:center;gap:12px}
    .badge{padding:4px 8px;border-radius:100px;font-size:11px;color:#0a0f2b;font-weight:700}
    .badge.ok{background:var(--ok)}
    .badge.err{background:var(--err)}

    .table-card{padding:0;overflow:auto}
    table{width:100%;border-collapse:collapse;font-size:13px}
    thead th{text-align:left;font-weight:700;font-size:12px;color:var(--muted);padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.02);position:sticky;top:0}
    tbody td{padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.06)}
    tbody tr:nth-child(even){background:var(--stripe)}
    .player{display:flex;align-items:center;gap:10px}
    .avatar{width:28px;height:28px;border-radius:50%;border:1px solid rgba(255,255,255,.12);object-fit:cover}
    .steam{color:var(--muted);font-size:11px}
    .sub{color:var(--muted);font-size:11px}
    .group{display:flex;flex-wrap:wrap;gap:6px}
    .pill{background:var(--chip);border:1px solid rgba(255,255,255,.08);padding:4px 8px;border-radius:999px;font-size:11px;white-space:nowrap}
    .pill b{font-weight:800}

    body{background:var(--bg);} /* fallback color */
    body::before{
    content:"";position:fixed;inset:0;z-index:-1;pointer-events:none;
    background:radial-gradient(1200px 800px at 10% 0%, #1a1f47 0%, var(--bg) 60%), var(--bg);
    background-repeat:no-repeat;background-attachment:fixed;
    will-change:transform;transform:translateZ(0); /* avoid repaint seams */
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>RankEval • SteamID & Team Viewer</h1>
      <div class="subtitle">We query <code>getleaderboards</code> with a single type (<b>Overall</b>) to get the player's SteamID, then fetch their team from <code>getteamleaderboards</code>.</div>
    </header>

    <section class="card controls">
      <div class="input">
        <label for="player">Player Name</label>
        <input id="player" type="text" placeholder="e.g. pyxploiter" value="pyxploiter" />
      </div>
      <button id="fetchBtn" class="btn-primary">Find Team</button>
      <button id="clearBtn" class="btn-ghost">Clear</button>
    </section>

    <div id="out" class="card result" style="display:none">
      <div>
        <div class="muted">SteamID (64-bit)</div>
        <div id="steamVal" class="big">—</div>
      </div>
      <div class="row">
        <button id="copyBtn" class="btn-ghost">Copy</button>
        <a id="steamLink" class="btn-ghost" target="_blank" rel="noopener">Open Steam</a>
      </div>
    </div>
    <div id="msg" class="subtitle" style="margin-top:10px"></div>

    <!-- TEAM SECTION -->
    <section class="section" id="teamSection" style="display:none">
      <h3>Team</h3>
      <div class="card">
        <div class="team-head">
          <div>
            <div class="subtitle">Team ID: <b id="teamId">—</b> <span id="teamClan" style="margin-left:8px"></span></div>
            <div class="muted" id="teamMeta">—</div>
          </div>
          <span id="teamBadge" class="badge">—</span>
        </div>
        <div class="kpis" style="padding:0 14px 14px">
          <div class="kpi"><div class="label">Rank</div><div class="value" id="teamRank">—</div></div>
          <div class="kpi"><div class="label">Rating</div><div class="value" id="teamRating">—</div></div>
          <div class="kpi"><div class="label">PVP</div><div class="value" id="teamPVP">—</div></div>
          <div class="kpi"><div class="label">PVE</div><div class="value" id="teamPVE">—</div></div>
          <div class="kpi"><div class="label">Ballistics</div><div class="value" id="teamBallistics">—</div></div>
          <div class="kpi"><div class="label">Gather</div><div class="value" id="teamGather">—</div></div>
        </div>
      </div>

      <div class="table-card card" style="margin-top:12px">
        <table id="tblTeam">
          <thead>
            <tr>
              <th>Player</th>
              <th>Rating & Perfs</th>
              <th>PVP</th>
              <th>PVE & Vehicles</th>
              <th>Gather</th>
              <th>Time</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </div>

  <script>
    // --- Config ---
    const PLAYER_API = "https://api.rankeval.gg/api/getleaderboards"; // single type only, to extract SteamID
    const SERVER_ID = "66af4fbe9dd0740a80453310";
    const TYPE = "Leaderboard"; // Overall
    const TEAM_API = "https://api.rankeval.gg/api/getteamleaderboards";

    const $ = (s)=>document.querySelector(s);
    const playerInput = $("#player");
    const fetchBtn = $("#fetchBtn");
    const clearBtn = $("#clearBtn");
    const out = $("#out");
    const steamVal = $("#steamVal");
    const msg = $("#msg");
    const copyBtn = $("#copyBtn");
    const steamLink = $("#steamLink");

    // Team refs
    const teamSection = $("#teamSection");
    const tblTeam = $("#tblTeam tbody");
    const teamBadge = $("#teamBadge");
    const teamId = $("#teamId");
    const teamClan = $("#teamClan");
    const teamMeta = $("#teamMeta");
    const teamRank = $("#teamRank");
    const teamRating = $("#teamRating");
    const teamPVP = $("#teamPVP");
    const teamPVE = $("#teamPVE");
    const teamBallistics = $("#teamBallistics");
    const teamGather = $("#teamGather");

    function buildPlayerUrl(name){
      const q = encodeURIComponent((name||"").trim());
      return `${PLAYER_API}?q=${q}&ServerFilter=${SERVER_ID}&Type=${TYPE}`;
    }
    function buildTeamUrl(steam){
      const q = encodeURIComponent(steam);
      return `${TEAM_API}?q=${q}&ServerFilter=${SERVER_ID}`;
    }

    function setStatus(text,isError=false){
      msg.textContent = text || "";
      msg.classList.toggle('err', !!isError);
    }

    function showSteam(id){
      if(!id){ out.style.display='none'; return; }
      steamVal.textContent = id;
      steamLink.href = `https://steamcommunity.com/profiles/${id}`;
      steamLink.style.display = 'inline-block';
      out.style.display = 'flex';
    }

    function fmtTime(seconds){
      if(!seconds && seconds!==0) return '—';
      const h=Math.floor(seconds/3600), m=Math.floor((seconds%3600)/60); return `${h}h ${m}m`;
    }

    function emptyTeamTable(){
      tblTeam.innerHTML = `<tr><td colspan="6" class="muted" style="text-align:center">No team data</td></tr>`;
    }

    function renderTeam(team){
      if(!team){
        teamSection.style.display='block';
        teamBadge.textContent='No team'; teamBadge.className='badge err';
        teamId.textContent='—'; teamClan.textContent=''; teamMeta.textContent='No team found for this player on this server.';
        teamRank.textContent=teamRating.textContent=teamPVP.textContent=teamPVE.textContent=teamBallistics.textContent=teamGather.textContent='—';
        emptyTeamTable();
        return;
      }
      teamSection.style.display='block';
      teamBadge.textContent='OK'; teamBadge.className='badge ok';
      teamId.textContent = team.TeamID || '—';
      teamClan.textContent = team.ClanTag ? `(${team.ClanTag})` : '';
      teamMeta.textContent = `Last updated ${new Date(team.LastUpdated).toLocaleString()} • Members ${team.SteamIDs?.length||0}`;
      const rk = team.Rankings || {};
      teamRank.textContent = rk.Rank ?? '—';
      teamRating.textContent = rk.Rating ?? '—';
      teamPVP.textContent = rk.PVPPerf ?? '—';
      teamPVE.textContent = rk.PVEPerf ?? '—';
      teamBallistics.textContent = rk.BallisticsPerf ?? '—';
      teamGather.textContent = rk.GatherPerf ?? '—';

      const members = Array.isArray(team.TeamPlayerData) ? team.TeamPlayerData : [];
      if(!members.length){ emptyTeamTable(); return; }
      tblTeam.innerHTML = '';
      for(const m of members){
        const avatar = m?.User?.Avatar?.avatarMedium || m?.User?.Avatar?.avatar || m?.User?.Avatar?.avatarFull || '';
        const mrk = m?.Rankings || {};
        const v = (x)=> (x ?? 0);

        const ratingBlock = `
          <div class="big">${mrk.Rating ?? '—'}</div>
          <div class="group" style="margin-top:6px">
            ${mrk.PVPPerf != null ? `<span class="pill"><b>PVP</b>&nbsp;${mrk.PVPPerf}</span>` : ''}
            ${mrk.PVEPerf != null ? `<span class="pill"><b>PVE</b>&nbsp;${mrk.PVEPerf}</span>` : ''}
            ${mrk.BallisticsPerf != null ? `<span class="pill"><b>Ballistics</b>&nbsp;${mrk.BallisticsPerf}</span>` : ''}
            ${mrk.GatherPerf != null ? `<span class="pill"><b>Gather</b>&nbsp;${mrk.GatherPerf}</span>` : ''}
          </div>`;

        const pvpBlock = `
          <div class="group">
            <span class="pill"><b>KDR</b>&nbsp;${v(m.KDR)}</span>
            <span class="pill"><b>Kills</b>&nbsp;${v(m.PVPKills)}</span>
            <span class="pill"><b>Deaths</b>&nbsp;${v(m.Deaths)}</span>
            <span class="pill"><b>Arrows</b>&nbsp;${v(m.ArrowsFired)}</span>
            <span class="pill"><b>Bullets</b>&nbsp;${v(m.BulletsFired)}</span>
            <span class="pill"><b>Rockets</b>&nbsp;${v(m.RocketsLaunched)}</span>
            <span class="pill"><b>Explosives</b>&nbsp;${v(m.ExplosivesThrown)}</span>
          </div>`;

        const pveVehBlock = `
          <div class="group">
            <span class="pill"><b>PVE</b>&nbsp;${v(m.PVEKills)}</span>
            <span class="pill"><b>NPC</b>&nbsp;${v(m.NPCKills)}</span>
            <span class="pill"><b>HeliHits</b>&nbsp;${v(m.HeliHits)}</span>
            <span class="pill"><b>HeliKills</b>&nbsp;${v(m.HeliKills)}</span>
            <span class="pill"><b>APCHits</b>&nbsp;${v(m.APCHits)}</span>
            <span class="pill"><b>APCKills</b>&nbsp;${v(m.APCKills)}</span>
          </div>`;

        const gatherBlock = `
          <div class="group">
            <span class="pill"><b>Wood</b>&nbsp;${v(m.Wood)}</span>
            <span class="pill"><b>Stone</b>&nbsp;${v(m.Stone)}</span>
            <span class="pill"><b>Sulfur</b>&nbsp;${v(m.Sulfur)}</span>
            <span class="pill"><b>Metal</b>&nbsp;${v(m.Metal)}</span>
            <span class="pill"><b>HQM</b>&nbsp;${v(m.HQM)}</span>
          </div>`;

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>
            <div class="player">
              ${avatar?`<img class="avatar" src="${avatar}" alt="">`:''}
              <div>
                <div>${m.Name||'—'}</div>
                <div class="sub steam">${m.SteamID||'—'}</div>
              </div>
            </div>
          </td>
          <td>${ratingBlock}</td>
          <td>${pvpBlock}</td>
          <td>${pveVehBlock}</td>
          <td>${gatherBlock}</td>
          <td>${fmtTime(m.TimePlayed)}</td>`;
        tblTeam.appendChild(tr);
      }
    }

    async function fetchSteamAndTeam(){
      const name = playerInput.value.trim();
      if(!name){ setStatus('Please enter a player name.', true); playerInput.focus(); return; }
      setStatus('Looking up SteamID via Overall leaderboard…');
      showSteam(null); teamSection.style.display='none';
      try{
        const res = await fetch(buildPlayerUrl(name), { headers:{ 'Accept':'application/json' } });
        if(!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        const list = Array.isArray(data?.leaderboard) ? data.leaderboard : [];
        const exact = list.find(x => typeof x?.Name === 'string' && x.Name.toLowerCase() === name.toLowerCase());
        const pick = exact || list[0];
        const steamId = pick?.SteamID || null;
        if(!steamId){ setStatus('No SteamID found for that name on this server.', true); return; }
        showSteam(steamId);
        setStatus('Fetching team…');

        const tRes = await fetch(buildTeamUrl(steamId), { headers:{ 'Accept':'application/json' } });
        if(!tRes.ok) throw new Error(`TEAM HTTP ${tRes.status}`);
        const tData = await tRes.json();
        const team = Array.isArray(tData?.leaderboard) ? tData.leaderboard[0] : null;
        renderTeam(team);
        setStatus('Done.');
      }catch(e){ console.error(e); setStatus(`Failed: ${e.message||e}`, true); renderTeam(null); }
    }

    fetchBtn.addEventListener('click', fetchSteamAndTeam);
    clearBtn.addEventListener('click', () => { setStatus(''); showSteam(null); teamSection.style.display='none'; playerInput.value=''; playerInput.focus(); });
    playerInput.addEventListener('keydown', e => { if(e.key==='Enter') fetchSteamAndTeam(); });
    copyBtn.addEventListener('click', async () => { const t = steamVal.textContent.trim(); if(!t) return; try{ await navigator.clipboard.writeText(t); copyBtn.textContent='Copied!'; setTimeout(()=> copyBtn.textContent='Copy', 900);}catch{ setStatus('Copy failed. You can select the SteamID manually.', true);} });
  </script>
</body>
</html>
